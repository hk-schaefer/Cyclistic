<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Hartmut Schaefer" />


<title>Case Study: How Does a Bike-Share Navigate Speedy Success</title>

<script src="site_libs/header-attrs-2.20/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Case Study: Cyclistic</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="introduction.html">Introduction</a>
</li>
<li>
  <a href="project1.html">Project in SQL and Talbleau</a>
</li>
<li>
  <a href="project2.html">Project in R</a>
</li>
<li>
  <a href="https://www.linkedin.com/in/hartmut-schaefer">
    <span class="fab fa-linkedin"></span>
     
    LinkedIn
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Case Study: How Does a Bike-Share Navigate
Speedy Success</h1>
<h4 class="author">Hartmut Schaefer</h4>

</div>


<p><br />
<br />
</p>
<div id="ii.-data-cleaning-in-r" class="section level1">
<h1>II. Data Cleaning in R</h1>
<p><br />
</p>
<p><strong>Pre-requisites</strong></p>
<p>Dataframe names:<br />
</p>
<ul>
<li><em>df_trips_YYYYMM:</em> raw data input for each month<br />
</li>
<li><em>df_trips_all_raw:</em> merged data of all months<br />
</li>
<li><em>df_trips_all_clean_xxx:</em> cleaned data<br />
</li>
<li><em>df_trips_all_trans:</em> added columns for duration, weekdays,
hours<br />
</li>
<li><em>df_trips_all_fct:</em> format categorical variables into
factors<br />
</li>
<li><em>df_trips_all_final:</em> removed outliers<br />
</li>
<li><em>df_trips_all_final_dense:</em> removed non essential
columns<br />
<br />
</li>
</ul>
<p><strong>Install and load packages:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<p><br />
</p>
<div id="importing-raw-data" class="section level2">
<h2>1 Importing raw data</h2>
<div id="importing-data" class="section level3">
<h3>1.1 Importing data</h3>
<p><strong>Datasets</strong></p>
<p>Please download the following data files from the [Link] (<a
href="https://divvy-tripdata.s3.amazonaws.com/index.html"
class="uri">https://divvy-tripdata.s3.amazonaws.com/index.html</a>) and
copy them into your working directory “data” of RStudio<br />
</p>
<p>Data set: ‘202201-divvy-tripdata.csv’ (data for one month
Jan. 2022)<br />
Data set: ‘202202-divvy-tripdata.csv’ (data for one month
Feb. 2022)<br />
Data set: ‘202203-divvy-tripdata.csv’ (data for one month
Mar. 2022)<br />
Data set: ‘202204-divvy-tripdata.csv’ (data for one month
Apr. 2022)<br />
Data set: ‘202205-divvy-tripdata.csv’ (data for one month May.
2022)<br />
Data set: ‘202206-divvy-tripdata.csv’ (data for one month
Jun. 2022)<br />
Data set: ‘202207-divvy-tripdata.csv’ (data for one month
Jul. 2022)<br />
Data set: ‘202208-divvy-tripdata.csv’ (data for one month
Aug. 2022)<br />
Data set: ‘202209-divvy-tripdata.csv’ (data for one month
Sep. 2022)<br />
Data set: ‘202210-divvy-tripdata.csv’ (data for one month
Oct. 2022)<br />
Data set: ‘202211-divvy-tripdata.csv’ (data for one month
Nov. 2022)<br />
Data set: ‘202212-divvy-tripdata.csv’ (data for one month
Dec. 2022)<br />
<br />
</p>
<p>Reading 12 CSV files into separated dataframes from the local
storage:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------ set wd with here</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>file_202201 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202201-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>file_202202 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202202-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>file_202203 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202203-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>file_202204 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202204-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>file_202205 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202205-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>file_202206 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202206-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>file_202207 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202207-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>file_202208 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202208-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>file_202209 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202209-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>file_202210 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202210-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>file_202211 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202211-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>file_202212 <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;202212-divvy-tripdata.csv&quot;</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------ read files</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>df_trips_202201 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202201)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>df_trips_202202 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202202)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>df_trips_202203 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202203)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>df_trips_202204 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202204)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>df_trips_202205 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202205)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df_trips_202206 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202206)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>df_trips_202207 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202207)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>df_trips_202208 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202208)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>df_trips_202209 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202209)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df_trips_202210 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202210)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>df_trips_202211 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202211)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>df_trips_202212 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_202212)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------- clean up</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(file_202201,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>   file_202202,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>   file_202203,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>   file_202204,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>   file_202205,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>   file_202206,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>   file_202207,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>   file_202208,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>   file_202209,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>   file_202210,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>   file_202211,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>   file_202212</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>   )</span></code></pre></div>
<p><br />
</p>
</div>
<div id="union-data" class="section level3">
<h3>1.2 Union data</h3>
<p>Next we will merge all 12 dataframes into one single dataframe with
all the raw data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------ union all files into one data frame</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df_trips_all_raw <span class="ot">&lt;-</span> df_trips_202201 <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202202) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202203) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202204) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202205) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202206) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202207) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202208) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202209) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202210) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202211) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union_all</span>(df_trips_202212)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------- remove single files</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_202201,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>   df_trips_202202,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>   df_trips_202203,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>   df_trips_202204,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>   df_trips_202205,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>   df_trips_202206,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>   df_trips_202207,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>   df_trips_202208,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>   df_trips_202209,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>   df_trips_202210,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>   df_trips_202211,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>   df_trips_202212</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>Numbers of rows: 5,667,717<br />
</li>
<li>Numbers of columns: 13<br />
<br />
</li>
</ul>
<p><br />
</p>
<p><br />
</p>
</div>
</div>
<div id="cleaning-the-data" class="section level2">
<h2>2. Cleaning the data</h2>
<p><br />
</p>
<div id="check-data-integrity" class="section level3">
<h3>2.1 Check data integrity</h3>
<div id="check-numbers-of-nas" class="section level4">
<h4>2.1.1 Check numbers of NAs</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(df_trips_all_raw)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>##                         .
## ride_id                 0
## rideable_type           0
## started_at              0
## ended_at                0
## start_station_name 833064
## start_station_id   833064
## end_station_name   892742
## end_station_id     892742
## start_lat               0
## start_lng               0
## end_lat              5858
## end_lng              5858
## member_casual           0</code></pre>
<p>Result:<br />
</p>
<ul>
<li>About 1.7 million start or end station names are missing.<br />
</li>
<li>Geo-codes are mostly available. However, the reconstruction of
station names from geo-codes would require a more deep-dive into
map-matching and is out of the scope of this project. We, therefore have
to remove all rows with NAs, which is acceptable since we still have
about 75% of data left.<br />
</li>
</ul>
<p><br />
</p>
</div>
<div id="check-time-range" class="section level4">
<h4>2.1.2 Check time range</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_raw <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_start =</span> <span class="fu">min</span>(started_at), </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_start =</span> <span class="fu">max</span>(started_at),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_end =</span> <span class="fu">min</span>(ended_at), </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_end =</span> <span class="fu">max</span>(ended_at)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;station&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;time range&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   station   `time range`       
##   &lt;chr&gt;     &lt;dttm&gt;             
## 1 min_start 2022-01-01 00:00:05
## 2 max_start 2022-12-31 23:59:26
## 3 min_end   2022-01-01 00:01:48
## 4 max_end   2023-01-02 04:56:45</code></pre>
<p><br />
Result:<br />
</p>
<ul>
<li>max end datetime exceeded by two days (2023-01-02). This will be
cleaned in the outlier removal step<br />
<br />
</li>
</ul>
</div>
<div id="check-for-time-dependency-issues" class="section level4">
<h4>2.1.3 Check for time dependency issues</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_raw <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(started_at <span class="sc">&gt;</span> ended_at) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_time_conflict =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   n_time_conflict
##             &lt;int&gt;
## 1             100</code></pre>
<p><br />
Result:<br />
</p>
<ul>
<li>There are 100 observations with a time conflict. These rows will be
removed.<br />
<br />
</li>
</ul>
</div>
<div id="check-distinct-values" class="section level4">
<h4>2.1.4 Check distinct values</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_raw <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_bike_type =</span> <span class="fu">n_distinct</span>(rideable_type),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_user =</span> <span class="fu">n_distinct</span>(member_casual),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_start_station =</span> <span class="fu">n_distinct</span>(start_station_name),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_end_station =</span> <span class="fu">n_distinct</span>(end_station_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;variables&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;distinct count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   variables       `distinct count`
##   &lt;chr&gt;                      &lt;int&gt;
## 1 n_bike_type                    3
## 2 n_user                         2
## 3 n_start_station             1675
## 4 n_end_station               1693</code></pre>
<p><br />
Result:<br />
</p>
<ul>
<li>Distinct numbers of bike types (3) and users (2) are plausible<br />
</li>
<li>Distinct number of start and end station (1693) is exceeding the
amount of stated 600 docking stations. The stations listed in the
dataset may include different names for the same docking station as well
as non-docking locations. Since we have no further information, we will
treat all 1693 stations as valid.<br />
<br />
</li>
</ul>
</div>
<div id="check-for-location-outliers" class="section level4">
<h4>2.1.5 Check for location outliers</h4>
<p>Create a dataframe for stations:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------- df for start stations </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_start_stations <span class="ot">&lt;-</span> df_trips_all_raw <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(start_station_name, start_lat, start_lng) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(start_station_name) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(start_lat) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(start_lng)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_station_name) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">latitude =</span> <span class="fu">mean</span>(start_lat),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">longitude =</span> <span class="fu">mean</span>(start_lng)) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">station_name =</span> start_station_name, latitude, longitude) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------- df for start stations </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>df_end_stations <span class="ot">&lt;-</span> df_trips_all_raw <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(end_station_name, end_lat, end_lng) <span class="sc">%&gt;%</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(end_station_name) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(end_lat) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(end_lng)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_station_name) <span class="sc">%&gt;%</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">latitude =</span> <span class="fu">mean</span>(end_lat),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">longitude =</span> <span class="fu">mean</span>(end_lng)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">station_name =</span> end_station_name, latitude, longitude) <span class="sc">%&gt;%</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------- df all stations</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>df_stations <span class="ot">&lt;-</span> df_start_stations <span class="sc">%&gt;%</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union</span>(df_end_stations)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_start_stations, df_end_stations)</span></code></pre></div>
<p><br />
</p>
<p>Plot station location as virtual map:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------- plot all stations</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(df_stations, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(locations) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>()) <span class="sc">+</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;All stations&quot;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------- create plot for Greater Chicago Area (GCA)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>df_stations_gta <span class="ot">&lt;-</span> df_stations <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((longitude <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">90</span> <span class="sc">&amp;</span> longitude <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">87</span>) <span class="sc">&amp;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>         (latitude <span class="sc">&lt;</span> <span class="dv">44</span> <span class="sc">&amp;</span> latitude <span class="sc">&gt;</span> <span class="dv">40</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>locations_gta <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(df_stations_gta, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>pl2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(locations_gta) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>()) <span class="sc">+</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Stations GCA&quot;</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------=--------- arrange plots</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(pl2, pl1, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="project2_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(locations, locations_gta, df_stations, df_stations_gta, pl1, pl2)</span></code></pre></div>
<p>There are stations far from Chicago area, probably testing stations.
We will neglect these stations and set the area boundary of GCA
to:<br />
</p>
<ul>
<li>Longitude : [-88.0, -87.0]<br />
</li>
<li>Latitude : [41.4, 42.4]<br />
<br />
</li>
</ul>
<p>The following stations are identified as outliers:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lng_max <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">87</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lng_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">88</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>lat_max <span class="ot">&lt;-</span> <span class="fl">42.4</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>lat_min <span class="ot">&lt;-</span> <span class="fl">41.4</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>df_trips_all_raw <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">between</span>(end_lng, lng_min, lng_max) <span class="sc">&amp;</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(end_lat, lat_min, lat_max) <span class="sc">&amp;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(start_lng, lng_min, lng_max) <span class="sc">&amp;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(start_lat, lat_min, lat_max)))  <span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(start_station_name, start_lat, start_lng, end_station_name, end_lat, end_lng)</span></code></pre></div>
<pre><code>## # A tibble: 11 × 6
##    start_station_name                    start…¹ start…² end_s…³ end_lat end_lng
##    &lt;chr&gt;                                   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 Pawel Bialowas - Test- PBSC charging…    45.6   -73.8 Pawel …    41.9   -87.7
##  2 Dearborn St &amp; Adams St                   41.9   -87.6 &lt;NA&gt;       41.9   -88.1
##  3 Public Rack - Central Ave &amp; North Ave    41.9   -87.8 &lt;NA&gt;       41.9   -88.0
##  4 Franklin St &amp; Adams St (Temp)            41.9   -87.6 Green …     0       0  
##  5 Laflin St &amp; Cullerton St                 41.9   -87.7 Green …     0       0  
##  6 Canal St &amp; Adams St                      41.9   -87.6 Green …     0       0  
##  7 Morgan St &amp; Polk St                      41.9   -87.7 Green …     0       0  
##  8 Aberdeen St &amp; Randolph St                41.9   -87.7 Green …     0       0  
##  9 Green St &amp; Madison St                    41.9   -87.6 Green …     0       0  
## 10 LaSalle St &amp; Jackson Blvd                41.9   -87.6 Green …     0       0  
## 11 Green St &amp; Washington Blvd               41.9   -87.6 Green …     0       0  
## # … with abbreviated variable names ¹​start_lat, ²​start_lng, ³​end_station_name</code></pre>
<p>11 stations are outside of greater Chicago area. They will be removed
in the later cleaning process.<br />
<br />
<br />
</p>
</div>
</div>
<div id="cleaning-the-data-1" class="section level3">
<h3>2.2 Cleaning the data</h3>
<div id="remove-nas" class="section level4">
<h4>2.2.1 Remove NAs</h4>
<p>There are plenty of rows with missing values, related to missing
recordings of start and end stations. All rows with NAs will be
removed.<br />
<br />
</p>
<p>Remove rows with missing values:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_na <span class="ot">&lt;-</span> df_trips_all_raw <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(ride_id) <span class="sc">|</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(rideable_type) <span class="sc">|</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(started_at) <span class="sc">|</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(ended_at) <span class="sc">|</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(start_station_name) <span class="sc">|</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(start_station_id) <span class="sc">|</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(end_station_name) <span class="sc">|</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(end_station_id) <span class="sc">|</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(start_lat) <span class="sc">|</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(start_lng) <span class="sc">|</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(end_lat) <span class="sc">|</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(end_lng) <span class="sc">|</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(member_casual))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_raw)</span></code></pre></div>
<p><br />
Result:<br />
</p>
<ul>
<li>Number of rows removed (with NAs): 1,298,357 (23%)<br />
</li>
<li>Number of rows remaining (no NAs): 4,369,360<br />
<br />
<br />
</li>
</ul>
</div>
<div id="remove-service-stations" class="section level4">
<h4>2.2.2 Remove service stations:</h4>
<p>Service stations for maintenance or charging tests should be removed
from the dataset. Our first guess was that they can be identified by
their long station ID names. However, it turned out that some docking
stations with charging devices for electric bikes have long ID names as
well. After a review of the 1600 station IDs we identified the following
service station names:</p>
<ul>
<li>station IDs with name “Pawel Bialowas - Test- PBSC charging station”
(length 44)<br />
</li>
<li>station IDs with name “DIVVY CASSETTE REPAIR MOBILE STATION” (length
36)<br />
</li>
<li>station IDs with name “Hubbard Bike-checking (LBS-WH-TEST)” (length
35)<br />
</li>
<li>station IDs with name “DIVVY 001 - Warehouse test station” (length
34)<br />
</li>
<li>station IDs with name “2059 Hastings Warehouse Station” (length
31)<br />
</li>
<li>station IDs with name “Divvy Valet - Oakwood Beach” (length
27)<br />
</li>
<li>station IDs with name “Hastings WH 2” (length 13)<br />
</li>
</ul>
<p><br />
</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove service stations </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_serv <span class="ot">&lt;-</span> df_trips_all_clean_na <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;Pawel Bialowas&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;DIVVY CASSETTE&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;Hubbard&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;DIVVY 001&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;2059 Hastings&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;Divvy Valet&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(start_station_id, <span class="st">&quot;Hastings WH&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;Pawel Bialowas&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;DIVVY CASSETTE&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;Hubbard&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;DIVVY 001&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;2059 Hastings&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;Divvy Valet&quot;</span>) <span class="sc">|</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(end_station_id, <span class="st">&quot;Hastings WH&quot;</span>))</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_clean_na)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>Removed number of rows with service stations: 1,507<br />
</li>
<li>Remaining number of rows: 4,367,853<br />
<br />
<br />
</li>
</ul>
</div>
<div id="remove-location-outliers" class="section level4">
<h4>2.2.3 Remove location outliers</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lng_max <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">87</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>lng_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">88</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>lat_max <span class="ot">&lt;-</span> <span class="fl">42.4</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>lat_min <span class="ot">&lt;-</span> <span class="fl">41.4</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_serv <span class="ot">&lt;-</span> df_trips_all_clean_serv <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">between</span>(end_lng, lng_min, lng_max) <span class="sc">&amp;</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(end_lat, lat_min, lat_max) <span class="sc">&amp;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(start_lng, lng_min, lng_max) <span class="sc">&amp;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(start_lat, lat_min, lat_max))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lat_max, lat_min, lng_max, lng_min)</span></code></pre></div>
<p><br />
Result:<br />
</p>
<ul>
<li>Number of removed stations: 8<br />
</li>
<li>Number of remaining rows : 4,367,845<br />
<br />
<br />
</li>
</ul>
</div>
<div id="remove-duplicate-rows" class="section level4">
<h4>2.2.4 Remove duplicate rows</h4>
<p>In order to detect and remove duplicates we will compare all columns
except the unique ride_id:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_dup <span class="ot">&lt;-</span> df_trips_all_clean_serv <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(rideable_type,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           started_at,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>           ended_at,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>           start_station_name,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>           start_station_id,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>           end_station_name,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>           end_station_id,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>           start_lat,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>           start_lng,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>           end_lat,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>           end_lng,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>           member_casual,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">.keep_all =</span> <span class="cn">TRUE</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_clean_serv)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>Number of duplicate rows removed: 22<br />
</li>
<li>Number of remaining rows: 4,367,823<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="handling-dates" class="section level3">
<h3>2.3 Handling dates</h3>
<p>The imported data with time-stamps for start and end time are
recorded in local time (“America/Chicago” Central Time). In order to
account for daylight saving time (DST) the data and system environment
of RStudio have to be set to the <strong>same</strong> local time-zone
(TZ).<br />
<br />
</p>
<div id="setting-the-correct-time-zone" class="section level4">
<h4>2.3.1 Setting the correct time-zone</h4>
<p>The time-zone of the imported raw data are set by default to TZ =
“UTC”. Since the time-stamps were recorded in local time we have to
change the time zone of the data and the system environment.<br />
Note: The local standard time-zone like (CST - Central Standard Time)
does not have daylight saving times and using it will result in wrong
ride-time calculations.<br />
<br />
</p>
<p><strong>Set the system environment TZ:</strong><br />
</p>
<p><br />
</p>
<p>Setting the system time to local time “America/Chicago”:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set environment time zone</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> <span class="st">&quot;America/Chicago&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># confirm time-zone of system</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.timezone</span>()</span></code></pre></div>
<pre><code>## [1] &quot;America/Chicago&quot;</code></pre>
<p>Result: System time-zone set to “America/Chicago”<br />
<br />
</p>
<p><strong>Set date TZ:</strong></p>
<p><br />
Forcing TZ “America/Chicago” on time-stamps:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_trips_all_clean_dup</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Force  time-zone &quot;America/Chicago&quot; on dates without changing the values:</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>started_at <span class="ot">&lt;-</span> <span class="fu">force_tz</span>(df<span class="sc">$</span>started_at, <span class="at">tz =</span> <span class="st">&quot;America/Chicago&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>ended_at <span class="ot">&lt;-</span> <span class="fu">force_tz</span>(df<span class="sc">$</span>ended_at, <span class="at">tz =</span> <span class="st">&quot;America/Chicago&quot;</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="do">## check TZ</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>ended_at, <span class="st">&quot;tzone&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;America/Chicago&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(df<span class="sc">$</span>started_at, <span class="st">&quot;tzone&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;America/Chicago&quot;</code></pre>
<p>Result: Date time-zone set to “America/Chicago”<br />
<br />
<br />
</p>
</div>
<div id="correcting-for-daylight-saving-time" class="section level4">
<h4>2.3.2 Correcting for Daylight Saving Time</h4>
<p><strong>Spring: Advancing clock - time gap</strong></p>
<p>In spring on 2022-03-13 02:00:00 the time is advanced by 1 hour.
There is no time recording for 02:00:00 - 02:59:59. I.e. 01:59:59 + 1
sec = 03:00:00. Ride-time calculation by simple subtraction will create
an error of +60 min. The calculation will be automatically corrected by
the function <code>difftime()</code><br />
</p>
<p>Checking the correct calculation for rides during the time gap:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spring DST check</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_dst_spring <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((started_at <span class="sc">&gt;</span>  <span class="st">&#39;2022-03-13 01:55:00&#39;</span> <span class="sc">&amp;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            started_at <span class="sc">&lt;</span> <span class="st">&#39;2022-03-13 03:01:00&#39;</span>)) <span class="sc">%&gt;%</span>   </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ride_time =</span> <span class="fu">difftime</span>(ended_at, started_at, <span class="at">units =</span> <span class="st">&#39;mins&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(started_at, ended_at, ride_time) <span class="sc">%&gt;%</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(started_at)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_dst_spring)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   started_at          ended_at            ride_time    
##   &lt;dttm&gt;              &lt;dttm&gt;              &lt;drtn&gt;       
## 1 2022-03-13 01:57:29 2022-03-13 03:02:53 5.400000 mins
## 2 2022-03-13 01:57:57 2022-03-13 03:05:34 7.616667 mins</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_dst_spring)</span></code></pre></div>
<p>  Result: Calculation is correct. Time gap of 60 minutes skipped in
calculation<br />
<br />
</p>
<p><strong>Fall: Returning clock - time lap</strong></p>
<p>In autumn on 2022-11-06 02:00:00 the time is returned by 1 hour. The
time between 01:00:00 and 01:59:59 is recorded twice. To eliminate
ambiguity, the time would have had to be measured in UTC (e.g. GPS
tracker). In our data set however the time is measured in local time.
Thus we cannot determine whether the time stamp belongs to the first
path (before DST switch) or the second path (after DST switch).
Therefore, we will remove all time stamps originated or ended between
1am to 2am. Rides originated before 1am and ended after 2am will be
automatically corrected by the function <code>difftime()</code><br />
</p>
<p>Number of dates time slot at DST lap:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    (started_at <span class="sc">&gt;</span>  <span class="st">&#39;2022-11-06 01:00:00&#39;</span> <span class="sc">&amp;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>     started_at <span class="sc">&lt;</span> <span class="st">&#39;2022-11-06 02:00:00&#39;</span>) <span class="sc">|</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    (ended_at <span class="sc">&gt;</span>  <span class="st">&#39;2022-11-06 01:00:00&#39;</span> <span class="sc">&amp;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>     ended_at <span class="sc">&lt;</span> <span class="st">&#39;2022-11-06 02:00:00&#39;</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 341</code></pre>
<p>Result: 341 rows are affected<br />
<br />
</p>
<p>Removing dates from time slot at DST lap:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_dst <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>((started_at <span class="sc">&gt;</span>  <span class="st">&#39;2022-11-06 01:00:00&#39;</span> <span class="sc">&amp;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>       started_at <span class="sc">&lt;</span> <span class="st">&#39;2022-11-06 02:00:00&#39;</span>) <span class="sc">|</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      (ended_at <span class="sc">&gt;</span>  <span class="st">&#39;2022-11-06 01:00:00&#39;</span> <span class="sc">&amp;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>       ended_at <span class="sc">&lt;</span> <span class="st">&#39;2022-11-06 02:00:00&#39;</span>))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><br />
Result:<br />
</p>
<ul>
<li>Number of rows removed: 341<br />
</li>
<li>Number of rows remaining: 4,367,482<br />
<br />
<br />
</li>
</ul>
</div>
<div id="remove-rows-with-time-dependency-conflict-starttime-endtime"
class="section level4">
<h4>2.3.3 Remove rows with time dependency conflict: starttime &gt;
endtime</h4>
<p>There are still some rides where the end time is before the start
time.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_dst <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">difftime</span>(ended_at, started_at, <span class="at">units =</span> <span class="st">&#39;mins&#39;</span>) <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 37</code></pre>
<p>Result: There are 37 rides with negative ride time. All rides
originated and ended at the same station<br />
<br />
</p>
<p>Remove rides with datetime dependency conflict:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_clean_time <span class="ot">&lt;-</span> df_trips_all_clean_dst <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">difftime</span>(ended_at, started_at, <span class="at">units =</span> <span class="st">&#39;mins&#39;</span>) <span class="sc">&lt;</span> <span class="dv">0</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_clean_dup, df_trips_all_clean_dst, df)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>Number of rows with time conflicts removed: 37<br />
</li>
<li>Number of remaining rows: 4,367,445<br />
<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="transform-data" class="section level3">
<h3>2.4 Transform data</h3>
<div id="add-calculated-variables-for-duration-weekdays-and-hours"
class="section level4">
<h4>2.4.1 Add calculated variables for duration, weekdays, and
hours</h4>
<p>For further analysis we will now calculate the ride time (duration)
and extract year, month_name, day_name and hour from start time.<br />
</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add columns for ride duration, year, month, day, weekday, hour</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df_trips_all_trans <span class="ot">&lt;-</span> df_trips_all_clean_time <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ride_time =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(ended_at, started_at, <span class="at">units =</span> <span class="st">&#39;mins&#39;</span>)),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(started_at),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">month_name =</span> <span class="fu">month</span>(started_at, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">weekday =</span> <span class="fu">wday</span>(started_at, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">hour</span>(started_at)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_clean_time)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="format-categorical-variables-to-factors"
class="section level4">
<h4>2.4.2 Format categorical variables to factors</h4>
<p>We will now convert categorical variables into factors with defined
ordered levels. This will allow us to apply useful graphics:<br />
</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_trips_all_trans</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>rideable_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>rideable_type, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>member_casual <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>member_casual, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>hour <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>hour, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>df_trips_all_fct <span class="ot">&lt;-</span> df</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df, df_trips_all_trans)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="add-sub-groups-for-time-categories" class="section level4">
<h4>2.4.3 Add sub-groups for time categories:</h4>
<p>We will now add sub-groups for season, week and day defined as
follows:</p>
<ul>
<li>season: winter, spring, summer, autumn<br />
</li>
<li>day_type: weekend, workday<br />
</li>
<li>hour_type: night, morning, afternoon, evening<br />
</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_fct <span class="ot">&lt;-</span> df_trips_all_fct <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">fct_collapse</span>(month_name, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">winter =</span> <span class="fu">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">spring =</span> <span class="fu">c</span>(<span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jun&quot;</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">summer =</span> <span class="fu">c</span>(<span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">autumn =</span> <span class="fu">c</span>(<span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">day_type =</span> <span class="fu">fct_collapse</span>(weekday,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">workday =</span> <span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weekend =</span> <span class="fu">c</span>(<span class="st">&quot;Sat&quot;</span>, <span class="st">&quot;Sun&quot;</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour_type =</span> <span class="fu">fct_collapse</span>(hour,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">night =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">morning  =</span> <span class="fu">c</span>(<span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">afternoon =</span> <span class="fu">c</span>(<span class="st">&quot;12&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">evening =</span> <span class="fu">c</span>(<span class="st">&quot;18&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;21&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;23&quot;</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p><br />
<br />
</p>
</div>
</div>
<div id="treatment-of-outliers" class="section level3">
<h3>2.5 Treatment of outliers</h3>
<div id="identify-outliers" class="section level4">
<h4>2.5.1 Identify outliers</h4>
<p>First let’s explore the distribution of <code>ride_time</code> by
user group and bike type to identify possible outliers.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_fct <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(member_casual, rideable_type) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_num_of_rides =</span> <span class="fu">n</span>(),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_ride_time =</span> <span class="fu">min</span>(ride_time),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_ride_time =</span> <span class="fu">max</span>(ride_time))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
## # Groups:   member_casual [2]
##   member_casual rideable_type Total_num_of_rides min_ride_time max_ride_time
##   &lt;ord&gt;         &lt;ord&gt;                      &lt;int&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1 casual        classic_bike              888659             0         1499.
## 2 casual        docked_bike               174811             0        32035.
## 3 casual        electric_bike             693784             0          480.
## 4 member        classic_bike             1708456             0         1493.
## 5 member        electric_bike             901735             0          480</code></pre>
<p>Result:<br />
</p>
<ul>
<li>max ride time classic bikes is 1499 min (about 24 hours)<br />
</li>
<li>max ride time of electric bikes is 480 min (8 hours)<br />
</li>
<li>max ride time of docked bikes is 32,000 min (about 22 days)<br />
</li>
<li>min ride time is zero for all groups<br />
</li>
</ul>
<p>To get more insight into the data we will use histograms for each
group:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_fct <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(ride_time), <span class="at">binwidth =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">35000</span>, <span class="at">by =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Ride time (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>)<span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Histogram zoomed-out&quot;</span>)<span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(member_casual<span class="sc">~</span>rideable_type)<span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/histogram%20-%20outlier%201-1.png" width="672" /><br />
<br />
</p>
<p>Result: apparently only the docked_bike type shows outliers. Let’s
zoom-in to ride time 1,500 minutes:<br />
</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_fct <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(ride_time), <span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2000</span>)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2000</span>, <span class="at">by =</span> <span class="dv">500</span>)) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Ride time (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>)<span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Histogram zoomed-in&quot;</span>)<span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(member_casual<span class="sc">~</span>rideable_type)<span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/histogram%20-%20outlier%202-1.png" width="672" /><br />
<br />
Result:<br />
</p>
<ul>
<li>ride time with classic bikes is capped at around 1500 min in both
user groups.<br />
</li>
<li>ride time with electric bikes is capped at around 500 min in both
user groups.<br />
</li>
<li>ride time with docked bikes has values beyond 1500 min.<br />
</li>
</ul>
<p>We don’t see evidence for outliers in groups classic bike and
electric bike due to its continuous distribution, However, in the case
of docked bikes we see an sudden change in the pattern, a kind of noise
starting from 1500.<br />
Therefore, the upper threshold to remove outlier will be set to 1500
minutes.<br />
</p>
<p>We make the decision to set the lower threshold to 1 minute. Rides
less than 1 minute can be classified as bike management to dock and
release bikes in order to reset the rent status. For more details see
DIVVY pricing program in page “Introduction/Appendix”.<br />
<br />
<br />
</p>
</div>
<div id="remove-outliers" class="section level4">
<h4>2.5.2. Remove outliers</h4>
<p>Now, after we have defined the boundary values [1, 1500] let’s remove
the outliers:</p>
<p><br />
</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>low <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>df_trips_all_final <span class="ot">&lt;-</span> df_trips_all_fct <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ride_time <span class="sc">&lt;</span> low <span class="sc">|</span> ride_time <span class="sc">&gt;</span> up))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_fct, low, up)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>Removed outliers: 76,473<br />
</li>
<li>Remaining rows: 4,290,971<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="export-cleaned-data-frame" class="section level3">
<h3>2.6 Export cleaned data frame</h3>
<div id="remove-irrelevant-variables" class="section level4">
<h4>2.6.1 Remove irrelevant variables</h4>
<p>The following variables will be removed from the dataframe, as they
are not essential for the further analysis<br />
</p>
<ul>
<li>ride_id<br />
</li>
<li>ended_at<br />
</li>
<li>start_station_id<br />
</li>
<li>end_station_id<br />
</li>
<li>year</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_trips_all_final_dense <span class="ot">&lt;-</span> df_trips_all_final <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">bike_type =</span> rideable_type,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_time =</span> started_at,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_station =</span> start_station_name,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">end_station =</span> end_station_name,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_latitude =</span> start_lat,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_longitude =</span> start_lng,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">end_latitude =</span> end_lat,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">end_longitude =</span> end_lng,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">user =</span> member_casual,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>         ride_time,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>         month_name,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>         weekday,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>         hour,</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>         season,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>         day_type,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>         hour_type</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_final)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="export-cleaned-file" class="section level4">
<h4>2.6.2 Export cleaned file</h4>
<p><br />
NOTE: ordered factor setting will be lost in the CSV file. Therefore, we
will create an RDS file that can be used to in the rMarkdown file for
analysis.<br />
<br />
<br />
</p>
</div>
</div>
</div>
</div>
<div id="iii.-data-analysis-in-r" class="section level1">
<h1>III. Data Analysis in R</h1>
<p><strong>Pre-requisites</strong><br />
</p>
<p>Global settings for scale and color:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">### switch scientific number output OFF with &quot;option(scipen = 999)&quot; and ON with &quot;option(scipen = 0)&quot;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="do">### set color table (global)</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>color_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">users =</span> <span class="fu">c</span>(<span class="st">&quot;casual&quot;</span>, <span class="st">&quot;member&quot;</span>),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><br />
</p>
<p>For better readability we will rename the long dataframe name into a
short name:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_trips_all_final_dense</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># str(df)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(df)</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_trips_all_final_dense)</span></code></pre></div>
<p><br />
</p>
<p>Dataframe names:<br />
</p>
<ul>
<li><em>df:</em> dataframe with cleaned data</li>
<li><em>df_corr:</em> dataframe for correlation analysis</li>
<li><em>color_table:</em> dataframe with color definition</li>
</ul>
<p><br />
<br />
</p>
<div id="data-analysis-and-visualization" class="section level2">
<h2>3. Data analysis and visualization</h2>
<p><br />
</p>
<div id="descriptive-statistics" class="section level3">
<h3>3.1 Descriptive statistics</h3>
<div id="distribution-of-ride-time-in-a-histogram-graph"
class="section level4">
<h4>3.1.1 Distribution of ride-time in a histogram graph</h4>
<p>Let’s first get an overview of the ride-time distribution in each
group by histograms:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> ride_time, <span class="at">fill =</span> user, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>), <span class="at">binwidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;ride-time&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>)<span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">400000</span>, <span class="at">by =</span> <span class="dv">100000</span>))<span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of ride-time&quot;</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Jan-Dec 2022&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>user)<span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.2.1%20-%20distribution%20ride-time-1.png" width="672" /><br />
Result:<br />
</p>
<ul>
<li>The shapes of both distributions are similar, skewed to the right
(long tail)<br />
</li>
<li>The distribution of casuals is slightly wider than that of
members<br />
<br />
</li>
</ul>
</div>
<div id="key-measures-as-table" class="section level4">
<h4>3.1.2 Key measures as table</h4>
<p>Next let’s calculate for each user group the totals, mean, standard
deviation and other statistical measures:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------- totals</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate totals</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>sum_ride_time <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>ride_time)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>n_all <span class="ot">&lt;-</span><span class="fu">length</span>(df<span class="sc">$</span>ride_time)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------ Aggregate KPIs for user group</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user) <span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rides =</span> <span class="fu">round</span>(<span class="fu">n</span>()<span class="sc">/</span><span class="dv">1000</span>,<span class="dv">2</span>), </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">prop_rides =</span> <span class="fu">round</span>(<span class="fu">n</span>()<span class="sc">/</span>n_all<span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_ride_time =</span> <span class="fu">round</span>(<span class="fu">sum</span>(ride_time)<span class="sc">/</span><span class="dv">1000000</span>,<span class="dv">2</span>), </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">prop_total_ride_time =</span> <span class="fu">round</span>(<span class="fu">sum</span>(ride_time)<span class="sc">/</span>sum_ride_time<span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_ride_time =</span> <span class="fu">round</span>(<span class="fu">mean</span>(ride_time),<span class="dv">1</span>),</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_ride_time =</span> <span class="fu">round</span>(<span class="fu">sd</span>(ride_time), <span class="dv">1</span>),</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">med_ride_time =</span> <span class="fu">round</span>(<span class="fu">median</span>(ride_time),<span class="dv">1</span>),</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">quantile_lower =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(ride_time, <span class="fl">0.25</span>),<span class="dv">1</span>),</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">quantile_upper =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(ride_time, <span class="fl">0.75</span>),<span class="dv">1</span>),</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">iqr =</span> <span class="fu">round</span>(<span class="fu">IQR</span>(ride_time),<span class="dv">1</span>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------- Pivot dataframe for better visualization</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span> </span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">rides</span><span class="st">`</span>,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">prop_rides</span><span class="st">`</span>,</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">total_ride_time</span><span class="st">`</span>,</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">prop_total_ride_time</span><span class="st">`</span>,</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">avg_ride_time</span><span class="st">`</span>,</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">sd_ride_time</span><span class="st">`</span>, </span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">med_ride_time</span><span class="st">`</span>, </span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">quantile_lower</span><span class="st">`</span>,</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">quantile_upper</span><span class="st">`</span>,</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">iqr</span><span class="st">`</span>),</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Statistical values (Jan-Dec, 2022)&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> </span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> user, <span class="at">values_from =</span> values)</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------- rename stat measures</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> df3</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;rides&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Total rides [Tausend]&quot;</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;prop_rides&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Proportion total rides [%]&quot;</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;total_ride_time&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Total ride-time [Million min]&quot;</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;prop_total_ride_time&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Proportion total ride-time [%]&quot;</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;avg_ride_time&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Avg. ride-time [min]&quot;</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;sd_ride_time&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Standart deviation ride-time [min]&quot;</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;med_ride_time&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Median ride-time [min]&quot;</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;quantile_lower&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Quantile lower [min]&quot;</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;quantile_upper&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Quantile upper [min]&quot;</span></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>df4[df4 <span class="sc">==</span> <span class="st">&quot;iqr&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Inter quartile range IQR [min]&quot;</span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>df_kpis <span class="ot">&lt;-</span> df4    <span class="co">#------------------------------------------------- set df name</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------- print as table</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(df_kpis[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> , ])</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Statistical values (Jan-Dec, 2022)</th>
<th align="right">casual</th>
<th align="right">member</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Total rides [Tausend]</td>
<td align="right">1730.37</td>
<td align="right">2560.60</td>
</tr>
<tr class="even">
<td align="left">Proportion total rides [%]</td>
<td align="right">40.00</td>
<td align="right">60.00</td>
</tr>
<tr class="odd">
<td align="left">Total ride-time [Million min]</td>
<td align="right">41.74</td>
<td align="right">32.48</td>
</tr>
<tr class="even">
<td align="left">Proportion total ride-time [%]</td>
<td align="right">56.00</td>
<td align="right">44.00</td>
</tr>
<tr class="odd">
<td align="left">Avg. ride-time [min]</td>
<td align="right">24.10</td>
<td align="right">12.70</td>
</tr>
<tr class="even">
<td align="left">Standart deviation ride-time [min]</td>
<td align="right">43.20</td>
<td align="right">19.10</td>
</tr>
<tr class="odd">
<td align="left">Median ride-time [min]</td>
<td align="right">14.10</td>
<td align="right">9.20</td>
</tr>
<tr class="even">
<td align="left">Quantile lower [min]</td>
<td align="right">8.10</td>
<td align="right">5.40</td>
</tr>
<tr class="odd">
<td align="left">Quantile upper [min]</td>
<td align="right">26.10</td>
<td align="right">15.60</td>
</tr>
<tr class="even">
<td align="left">Inter quartile range IQR [min]</td>
<td align="right">18.00</td>
<td align="right">10.10</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------------- clean up</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df1, df2, df3, df_kpis, n_all, sum_ride_time)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="key-measures-as-bar-graphs" class="section level4">
<h4>3.1.3 Key measures as bar graphs</h4>
<p>Graph: Total number of rides, total ride-time and average ride-time
by user group. In a skewed distribution the average-value (mean) is not
so meaningful, instead we will use the median-value:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------- bar graph for total rides</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">frq_n =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> user, <span class="at">y =</span> n))<span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> user))<span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total number of rides&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3000000</span>)) <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Rides [Million]&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span>  </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&#39;(&#39;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(frq_n), <span class="st">&#39;)&#39;</span>)), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------ bar graph for total ride-time</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>pl2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user) <span class="sc">%&gt;%</span> </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rt =</span> <span class="fu">as.double</span>(<span class="fu">sum</span>(ride_time))) <span class="sc">%&gt;%</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frq_rt =</span> rt<span class="sc">/</span><span class="fu">sum</span>(rt)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> user, <span class="at">y =</span> rt))<span class="sc">+</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> user))<span class="sc">+</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total ride-time&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50000000</span>)) <span class="sc">+</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ride-time [Million min]&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> rt, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&#39;(&#39;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(frq_rt), <span class="st">&#39;)&#39;</span>)), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------- bar graph for median ride-time</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>pl3 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user) <span class="sc">%&gt;%</span> </span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">med_rt =</span> <span class="fu">round</span>(<span class="fu">median</span>(ride_time),<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> user, <span class="at">y =</span> med_rt))<span class="sc">+</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> user))<span class="sc">+</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Median ride-time&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Median ride-time [min]&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> med_rt, <span class="at">label =</span> <span class="fu">paste0</span>(med_rt)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------- display plots in one graph</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="co"># install and load package &quot;gridExtra&quot;</span></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(pl1, pl2, pl3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.1.2-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pl1, pl2, pl3)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>Members have more rides per year than casuals<br />
</li>
<li>Casuals have longer total ride-time<br />
</li>
<li>Casuals’ median ride-time is about 5 minutes longer that that of
members’ ride-time<br />
<br />
<br />
</li>
</ul>
</div>
<div id="key-measures-by-boxplot" class="section level4">
<h4>3.1.4 Key measures by boxplot</h4>
<p>For better understanding of the ride-time distribution we will use a
boxplot:<br />
</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data_means <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user)<span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(ride_time))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> user, <span class="at">y =</span> ride_time, <span class="at">color =</span> user))<span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_boxplot</span>(<span class="at">geom =</span> <span class="st">&quot;errorbar&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of ride-time&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ride-time (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------ annotation for casuals    </span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">0.57</span>, <span class="at">y=</span><span class="dv">8</span>, <span class="at">label=</span><span class="st">&quot;25%&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">0.57</span>, <span class="at">y=</span><span class="dv">15</span>, <span class="at">label=</span><span class="st">&quot;50%&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">0.57</span>, <span class="at">y=</span><span class="dv">27</span>, <span class="at">label=</span><span class="st">&quot;75%&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">1.44</span>, <span class="at">y=</span><span class="dv">8</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">8</span>,<span class="dv">2</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>    <span class="co"># q1</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">1.44</span>, <span class="at">y=</span><span class="dv">27</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">9</span>,<span class="dv">2</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>   <span class="co"># q3</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">0.9</span>, <span class="at">y=</span><span class="dv">16</span>, <span class="at">label=</span><span class="st">&quot;median&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span>            </span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">1.1</span>, <span class="at">y=</span><span class="dv">16</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">7</span>,<span class="dv">2</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>    <span class="co"># median</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">0.9</span>, <span class="at">y=</span><span class="fl">24.4</span>, <span class="at">label=</span><span class="st">&quot;mean&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">1.1</span>, <span class="at">y=</span><span class="fl">24.4</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">5</span>,<span class="dv">2</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>  <span class="co"># mean  </span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------ annotation for members     </span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">2.44</span>, <span class="at">y=</span><span class="fl">5.3</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">8</span>,<span class="dv">3</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>  <span class="co"># q1</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">2.44</span>, <span class="at">y=</span><span class="fl">9.2</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">7</span>,<span class="dv">3</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>  <span class="co"># median</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">2.44</span>, <span class="at">y=</span><span class="fl">15.5</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">9</span>,<span class="dv">3</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span> <span class="co"># q3</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">2.1</span>, <span class="at">y=</span><span class="fl">12.7</span>, <span class="at">label=</span><span class="fu">as.numeric</span>(df4[<span class="dv">5</span>,<span class="dv">3</span>]), <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>  <span class="co"># mean</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>        ) </span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.2.3%20-%20boxplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_means, df4)</span></code></pre></div>
<p>  How to read the boxplot:<br />
</p>
<ul>
<li>The middle line marks the mid-point at 50% or median (middle
quartile)<br />
</li>
<li>The lower box line (lower quartile) marks 25% of all values, the
upper box line (upper quartile) marks 75% of all values, the box height
contains, therefore, 50% of all values (ride-time),</li>
<li>The extended vertical lines (whiskers) represent more extreme
values. The longer these lines are the higher the spread is<br />
</li>
<li>Every values below or above the whiskers are potential
outliers<br />
</li>
<li>The big dot mark in the box is the mean value. For ideal normal
distribution the median and the mean should be the same or very
close<br />
<br />
</li>
</ul>
<p>Results for casuals:<br />
</p>
<ul>
<li>75% of rides by casuals are shorter than 26 min<br />
</li>
<li>50% of values (IQR) are between 8 to 26 min<br />
</li>
<li>The median point (mid-point) is at 14 min<br />
</li>
<li>The mean point is at 24 min</li>
<li>The spread is wide and even more skewed because mean and median are
far apart<br />
<br />
</li>
</ul>
<p>Results for members:<br />
</p>
<ul>
<li>75% of rides by members are shorter than 16 min<br />
</li>
<li>50% of values (IQR) are between 5 to 16 min<br />
</li>
<li>The median point (mid-point) is at 9 min<br />
</li>
<li>The mean point is at 13 min<br />
</li>
<li>The spread is more contained around the median and mean, i.e annual
members typical ride-time is quite constant<br />
<br />
</li>
</ul>
</div>
<div id="log-transform-ride-time-data-for-normalization"
class="section level4">
<h4>3.1.5. Log transform ride-time data for normalization</h4>
<p>Since the data are highly skewed a statistical test, like t-test, is
not meaningful. The data can however be normalized using a log
transformation.</p>
<p>Preparing a dataset with log-trans values:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_log <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ride_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ride_time_log =</span> <span class="fu">log10</span>(ride_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user, ride_time_log)</span></code></pre></div>
<p><br />
</p>
<p>Histogram of log-trans values:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df_log <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> ride_time_log, <span class="at">fill =</span> user, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>), <span class="at">binwidth =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;log10(ride-time)&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>)<span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">400000</span>, <span class="at">by =</span> <span class="dv">100000</span>))<span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of log10(ride-time)&quot;</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Jan-Dec 2022&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>user)<span class="sc">+</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%20-%20distribution%20log-ride-time-1.png" width="672" /><br />
Result: the distribution is now normalized<br />
<br />
</p>
<p>Boxplot of log-trans values:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>data_means <span class="ot">&lt;-</span> df_log <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user)<span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(ride_time_log))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>df_log <span class="sc">%&gt;%</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> user, <span class="at">y =</span> ride_time_log, <span class="at">color =</span> user))<span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_boxplot</span>(<span class="at">geom =</span> <span class="st">&quot;errorbar&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of log10(ride-time)&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;log10(ride-time)&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">3.5</span>)) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>        ) </span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%20-%20boxplot%20log-trans-1.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data_means)</span></code></pre></div>
<p><br />
Result: The boxplots are now symmetric, i.e. normalized, mean and median
are almost identical.<br />
<br />
<br />
</p>
<p><strong>T-test</strong> to test if the difference in mean between
groups is statistically significant:<br />
</p>
<ul>
<li>Ho-hypothesis: there is no significant difference between both
means<br />
</li>
<li>Ha-hypothesis (alternative): there is a significant difference
between both means<br />
</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ride_time_log <span class="sc">~</span> user, <span class="at">data =</span> df_log)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;p-value&quot;</span>, <span class="st">&quot;geometric mean casuals&quot;</span>, <span class="st">&quot;geometric mean members&quot;</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  tt<span class="sc">$</span>p.value,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>((<span class="dv">10</span> <span class="sc">**</span> tt<span class="sc">$</span>estimate[[<span class="dv">1</span>]]),<span class="dv">1</span>),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>((<span class="dv">10</span> <span class="sc">**</span> tt<span class="sc">$</span>estimate[[<span class="dv">2</span>]]),<span class="dv">1</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>tt_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(names, values)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tt_values)</span></code></pre></div>
<pre><code>##                    names values
## 1                p-value    0.0
## 2 geometric mean casuals   15.0
## 3 geometric mean members    9.2</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tt, names, values, tt_values, df_log)</span></code></pre></div>
<p>Result:<br />
</p>
<ul>
<li>The mean values calculated through the log10 transformation are very
close to the median and their difference is statistical significant with
p-value = 0<br />
</li>
<li>geometric mean casual = 15.0<br />
</li>
<li>geometric mean member = 9.2<br />
<br />
</li>
</ul>
</div>
<div id="conclusion-descriptive-statistical-values"
class="section level4">
<h4>3.1.5 Conclusion: Descriptive statistical values</h4>
<ul>
<li>The distribution of ride-time in both groups is skewed to the right,
i.e. concentration of shorter rides and fewer longer rides<br />
</li>
<li>Annual members ride more than casual riders over the year<br />
</li>
<li>Annual riders accumulate more ride-time over the year than annual
members<br />
</li>
<li>The median ride-time (equivalent to geom. mean) of casual riders is
significantly higher than for annual members<br />
</li>
<li>The ride-time of casual riders shows more fluctuations, whereas the
ride time of members is more contained around the mid-point<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="time-dependencies" class="section level3">
<h3>3.2 Time dependencies</h3>
<div id="number-of-rides-as-time-series" class="section level4">
<h4>3.2.1 Number of rides as time series</h4>
<p>Let’s first get an overview of the whole year cycle by number of
rides aggregated by day:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------- binwidth = 24 hours (3600*24 sec)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> start_time, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">3600</span><span class="sc">*</span><span class="dv">24</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color)<span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total number of rides over time&quot;</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Daily aggregates 2022&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>)<span class="sc">+</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">25000</span>, <span class="at">by =</span> <span class="dv">5000</span>))<span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>user, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.1%20-%20rides%20-%20time%20serie-1.png" width="672" /><br />
Result:<br />
</p>
<ul>
<li>Both signals show multiple overlapping cycles of different
frequencies over year, week and day<br />
</li>
<li>There are similarities but also differences<br />
</li>
</ul>
<p>Let’s brake down the signal by month, day and hour:<br />
<br />
<br />
</p>
</div>
<div id="annual-cycle-by-month" class="section level4">
<h4>3.2.2 Annual cycle by month</h4>
<p>We will plot the number of rides over year aggregated by months in
absolute values and in relative values<br />
Relative frequency is calculated by :
<code>frq_rides = n_month/n_year</code> per group:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------- line chart number of rides</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, month_name) <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_name, <span class="at">y =</span> n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides by month in 2022&quot;</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Absolut values, monthly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">400000</span>)) <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides [Thausend]&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> abbreviate) <span class="sc">+</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.83</span>),</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------- line chart frequency of rides</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>pl2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, month_name) <span class="sc">%&gt;%</span> </span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frq_n =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_name, <span class="at">y =</span> frq_n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Relative frequency&quot;</span>,</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Rel. frequency = n_month / n_year&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rel. frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------- display both plots </span></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a><span class="co"># install and load package &quot;gridExtra&quot;</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(pl1, pl2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.2%20-%20month%20-%20rides-1.png" width="672" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pl1, pl2)</span></code></pre></div>
<p>Results:<br />
</p>
<ul>
<li>Both, casuals and members, show similar behavior over the year:
Increase of rides in warmer months and decrease in colder months<br />
</li>
<li>The number of rides by casuals is almost dropping down to zero in
winter months January and February<br />
</li>
<li>Relatively, casuals show a steeper increase of rides in warmer
months compared to members<br />
<br />
</li>
</ul>
<p>Average ride-time by month:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------- line chart avg. ride-time</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, month_name) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_rt =</span> <span class="fu">round</span>(<span class="fu">mean</span>(ride_time),<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_name, <span class="at">y =</span> avg_rt, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average ride-time by month 2022&quot;</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Monthly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Avg. ride-time (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.83</span>),</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.2%20-%20month%20-%20avg%20ride-time-1.png" width="672" /><br />
Results:<br />
</p>
<ul>
<li>The average ride-time of casuals is longer compared to members
throughout the year<br />
</li>
<li>The average ride-time of members is almost constant over the year,
i.e. less dependent on seasons<br />
</li>
<li>The average ride-time of casuals is longer in the warmer months,
with peaks in March and May<br />
<br />
<br />
</li>
</ul>
</div>
<div id="weekly-cycle-by-day" class="section level4">
<h4>3.2.3 Weekly cycle by day</h4>
<p>Now, let’s plot the number of rides over a weak aggregated by days in
absolute values and in relative values<br />
Relative frequency is calculated by :
<code>frq_rides = n_day/n_year</code> per group:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------- line chart number of rides</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, weekday) <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weekday, <span class="at">y =</span> n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides by day in 2022&quot;</span>,</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Absolut values, daily aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500000</span>)) <span class="sc">+</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides [Thausend]&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.23</span>),</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------- line chart frequency of rides</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>pl2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, weekday) <span class="sc">%&gt;%</span> </span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frq_n =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weekday, <span class="at">y =</span> frq_n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Relative frequency&quot;</span>,</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Rel. frequency = n_day / n_year&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rel. frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------- display both plots </span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a><span class="co"># install and load package &quot;gridExtra&quot;</span></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(pl1, pl2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.3%20-%20weekday%20-%20rides-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pl1, pl2)</span></code></pre></div>
<p>Results:<br />
</p>
<ul>
<li>Casuals and members, show opposite behavior over the week<br />
</li>
<li>Members ride more on workdays, Monday to Friday, and less on
weekends<br />
</li>
<li>Casuals ride more on weekends and less on workdays<br />
</li>
<li>The rides of casuals increases sharply on weekends<br />
<br />
</li>
</ul>
<p>Average ride-time by day:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------- line chart avg. ride-time</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, weekday) <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_rt =</span> <span class="fu">round</span>(<span class="fu">mean</span>(ride_time),<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weekday, <span class="at">y =</span> avg_rt, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average ride-time by day 2022&quot;</span>,</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Daily aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Avg. ride-time&quot;</span>) <span class="sc">+</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.23</span>),</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.3%20-%20weekday%20-%20avg%20ride-time-1.png" width="672" /><br />
Results:<br />
</p>
<ul>
<li>The average ride-time of casuals is longer compared to members at
all time<br />
</li>
<li>The average ride-time of members is almost constant over the week,
with slight increase on weekends<br />
</li>
<li>The average ride-time of casuals is lowest on Wednesday and highest
on Sunday, i.e. casuals ride longer from Friday to Monday<br />
<br />
<br />
</li>
</ul>
</div>
<div id="daily-cycle-by-hour" class="section level4">
<h4>3.2.4 Daily cycle by hour</h4>
<p>Finally, let’s plot the number of rides over a day aggregated by
hours in absolute values and in relative values<br />
Relative frequency is calculated by :
<code>frq_rides = n_hour/n_year</code> per group:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------- line chart number of rides</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides by hour in 2022&quot;</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Absolut values, hourly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300000</span>)) <span class="sc">+</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.83</span>),</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------- line chart frequency of rides</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>pl2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frq_n =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> frq_n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Relative frequency&quot;</span>,</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Rel. frequency = n_hour / n_year&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.12</span>)) <span class="sc">+</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;hour&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rel. frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------- display both plots </span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a><span class="co"># install and load package &quot;gridExtra&quot;</span></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(pl1, pl2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.4%20-%20hour%20-%20rides-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pl1, pl2)</span></code></pre></div>
<p><br />
Results:<br />
</p>
<ul>
<li>The graph shows a substantial difference in ride behavior between
members and casuals:</li>
<li>Members show two relative maximums, one in the morning (8am) and one
in the afternoon (5pm), i.e. member use their bikes mainly for
commuting<br />
</li>
<li>Rides of casuals gradually increases from morning to afternoon
(5pm). The graph shows no peak at the morning commute.i.e. casuals seam
to use their bikes for other reasons than for commuting<br />
<br />
</li>
</ul>
<p>Average ride-time by hour:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_rt =</span> <span class="fu">round</span>(<span class="fu">mean</span>(ride_time),<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> avg_rt, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average ride-time&quot;</span>) <span class="sc">+</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average ride-time by hour 2022&quot;</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Hourly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Hour&quot;</span>) <span class="sc">+</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Avg. ride-time (min)&quot;</span>) <span class="sc">+</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.17</span>),</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.4.4%20-%20hour%20-%20avg%20ride-time-1.png" width="672" /><br />
Results:<br />
</p>
<ul>
<li>The average ride-time of casuals is higher compared to members at
all time<br />
</li>
<li>The average ride-time of members is almost constant at 13 minutes
over the day, i.e. less influenced by the hour<br />
</li>
<li>The average ride-time of casuals is longest from 9am to 5pm and
lowest from 4am to 8am<br />
</li>
</ul>
<p><br />
</p>
</div>
<div id="conclusions-time-dependencies-by-month-weekday-and-hours"
class="section level4">
<h4>3.2.5 Conclusions: Time dependencies by month, weekday and
hours</h4>
<p>Year:<br />
</p>
<ul>
<li>The number of ride cycle over the year follows the same pattern in
both groups, no significant differences due to season can be
observed<br />
</li>
<li>Both groups show an increase of rides in warmer seasons and decrease
in colder seasons<br />
</li>
<li>However, casuals show a steeper increase of rides in warmer months,
and a drop close to zero in January and February<br />
</li>
<li>The average ride time for casuals is increasing in warmer months,
highest from March to May<br />
</li>
<li>The average ride time of members is almost constant over the
year<br />
</li>
</ul>
<p>Week:<br />
</p>
<ul>
<li>Casuals prefer riding on weekends, whereas members ride is highest
on workdays<br />
</li>
<li>The average ride time of casuals increases on weekends more than for
members<br />
</li>
</ul>
<p>Day:<br />
</p>
<ul>
<li>Members prefer riding during commute time in the morning and
afternoon hours<br />
</li>
<li>Casuals riders, however, show no commute behavior, instead they
prefer to ride in the afternoon, assumingly for leisure<br />
</li>
<li>The average ride time of casuals is longer during the daytime than
at evening and night time<br />
</li>
<li>The average ride time of members is constant all over the day<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="usage-of-bike-types" class="section level3">
<h3>3.3 Usage of bike-types</h3>
<p>We will now break down the analysis further by bike-type
<code>classic bike</code> and <code>electric bike</code> to get an
insight whether there are significant differences between the user
groups:<br />
<br />
</p>
<div id="number-of-rides-in-percentage" class="section level4">
<h4>3.3.1 Number of rides (in percentage)</h4>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">### set color table (global)</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>color_table_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">bike_type =</span> <span class="fu">c</span>(<span class="st">&quot;classic_bike&quot;</span>, <span class="st">&quot;docked_bike&quot;</span>, <span class="st">&quot;electric_bike&quot;</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;#9AC0CD&quot;</span>, <span class="st">&quot;#009ACD&quot;</span>, <span class="st">&quot;#00688B&quot;</span>))</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, bike_type) <span class="sc">%&gt;%</span> </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frq_n =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span>   </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> user, <span class="at">y =</span> n, <span class="at">fill =</span> bike_type)) <span class="sc">+</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_table_2<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%1.1f&quot;</span>, frq_n<span class="sc">*</span><span class="dv">100</span>), <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">position=</span><span class="fu">position_fill</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">color=</span><span class="st">&quot;white&quot;</span>)<span class="sc">+</span>  </span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides per bike-type (in percent)&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Percent&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.5.1%20-%20total%20rides%20-%20percent-1.png" width="672" /><br />
Results:<br />
</p>
<ul>
<li>The preferred bike-type in both groups are classic bikes/</li>
<li>Casuals are more in favor of electric bikes than members (40%
against 34%) although the pricing of electric bikes for non-members is
$0.42/min and for members is only $0.17/min<br />
</li>
<li>The case study does not provide an explanation of
<code>docked bikes</code>. Since they are only used by casuals we
exclude this type from the further analysis<br />
<br />
Let’s look more deeply into the usage of each bike-type by month, week
and hour<br />
<br />
</li>
</ul>
</div>
<div id="dependency-by-month-and-day" class="section level4">
<h4>3.3.2 Dependency by month and day</h4>
<p>Total rides per bike-types aggregated by month for weekend and
workday:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, month_name, day_type, bike_type) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bike_type <span class="sc">!=</span> <span class="st">&quot;docked_bike&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_name, <span class="at">y =</span> n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point(size = 2) +</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides by month for bike-types in 2022&quot;</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Absolut values, monthly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200000</span>)) <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(),</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200000</span>, <span class="at">by =</span> <span class="dv">100000</span>))<span class="sc">+</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(bike_type<span class="sc">~</span>day_type)<span class="sc">+</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.08</span>, <span class="fl">0.92</span>),</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>, </span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.5.2%20-%20total%20rides%20-%20month-1.png" width="672" /><br />
Results:<br />
</p>
<ul>
<li>On weekends and in summer casuals use more E-bikes than
members<br />
</li>
<li>On workdays and in summer casuals show an increase usage of
E-bikes<br />
</li>
<li>The usage of classic bikes follows a similar pattern in both user
groups<br />
<br />
</li>
</ul>
</div>
<div id="dependency-by-hour-and-season-electric-bikes"
class="section level4">
<h4>3.3.3 Dependency by hour and season (electric bikes)</h4>
<p>Total rides of electric bikes aggregated by hour for different
seasons at weekend and workday:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, hour, day_type, season) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bike_type <span class="sc">==</span> <span class="st">&quot;electric_bike&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point(size = 2) +</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(day_type<span class="sc">~</span>season, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides by hour in 2022 (electric bikes)&quot;</span>,</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Absolut values, hourly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30000</span>)) <span class="sc">+</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;hour [0 - 23]&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>),</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x  =</span> <span class="fu">element_blank</span>()</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.5.3%20-%20total%20rides%20-%20day%20-%20electric-1.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(color_table_2)</span></code></pre></div>
<p><br />
Results:<br />
</p>
<ul>
<li>On weekend and in summer casuals use significantly more E-bikes than
members<br />
</li>
<li>On workdays surprisingly <strong>casuals show a slight peak at the
morning commute</strong>, indicating that a proportion of casual riders
use their E-bike for commuting and are <strong>potential customers to
convert to annual memberships</strong><br />
<br />
</li>
</ul>
</div>
<div id="dependency-by-hour-and-season-classic-bikes"
class="section level4">
<h4>3.3.4 Dependency by hour and season (classic bikes)</h4>
<p>Total rides of classic bikes aggregated by hour for different
seasons, weekend and workday:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user, hour, day_type, season) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bike_type <span class="sc">==</span> <span class="st">&quot;classic_bike&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> n, <span class="at">group =</span> user, <span class="at">color =</span> user)) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point(size = 2) +</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_table<span class="sc">$</span>color) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(day_type<span class="sc">~</span>season, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of rides by hour in 2022 (classic bikes)&quot;</span>,</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Absolut values, hourly aggregates&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30000</span>)) <span class="sc">+</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;hour [0 - 23]&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>())<span class="sc">+</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>),</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x  =</span> <span class="fu">element_blank</span>()</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%204.5.4%20-%20total%20rides%20-%20day%20-%20classic-1.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(color_table_2)</span></code></pre></div>
<p><br />
Results:<br />
</p>
<ul>
<li>On weekend and in warmer season almost identical usage of classic
bikes, but fewer rides by casuals in autumn and winter<br />
</li>
<li>On workdays casuals show a tiny peak also in the morning commute but
less than electric bike user, indicating that casuals do not use classic
bikes much for commuting<br />
</li>
<li>In general casuals have high demand of rides in warmer seasons but
very low demand in colder seasons<br />
<br />
<br />
</li>
</ul>
</div>
<div id="conclusion-usage-of-bike-types" class="section level4">
<h4>3.3.5 Conclusion: Usage of bike-types</h4>
<ul>
<li>Casuals are more in favor of electric bikes than members<br />
</li>
<li>On summer and spring weekends casuals use more electric bikes than
members<br />
</li>
<li>Casual use electric bikes to some extend also for morning commute,
and may be potential customers for memberships<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="spatial-distribution" class="section level3">
<h3>3.4 Spatial distribution</h3>
<div id="top-20-start-stations" class="section level4">
<h4>3.4.1 Top 20 start stations</h4>
<p>Next, let’s display the top 20 stations for casuals and
members.<br />
For the map visualization we used ggmap and geom_point. The map was
pulled from Google Map. A Google Map API is required. We will skip the
code here, since the map creation code was quite lengthy. If there is
any interest please let me know.<br />
</p>
<p>The following maps were created with ggmap and Google Map API:</p>
<p><img src="images/Top20_casual2.png" width="100%" style="display: block; margin: auto;" /><img src="images/Top20_member2.png" width="100%" style="display: block; margin: auto;" /><br />
Results:<br />
</p>
<ul>
<li>Top 20 stations for casuals are concentrated along the lake shore
and in park areas. The ride frequency of the top 20 stations ranges from
50K - 20K<br />
</li>
<li>Top 20 stations for members are in the city center, business area,
and university campuses. The ride frequency of the top 20 station ranges
from 22K to 16K, and is more equally distributed compared to
casuals<br />
<br />
</li>
</ul>
</div>
<div id="density-map-of-rides-by-location" class="section level4">
<h4>3.4.2 Density map of rides by location</h4>
<p>A density map visualizes the number of rides accumulated over the
full time span and mapped to the location of start stations. The range
is sliced in 50 levels. Each level is assigned to a color and bounded by
a polygon.<br />
For the visualization we used ggmap and stat_density2d function. The map
was pulled from Google Map. A Google Map API is required. We will skip
the code here, since the map creation code was quite lengthy. If there
is any interest please let me know.<br />
</p>
<p><img src="images/DensityCasual2.png" width="100%" style="display: block; margin: auto;" /><img src="images/DensityMember2.png" width="100%" style="display: block; margin: auto;" /><br />
Results:<br />
</p>
<ul>
<li>Location wise stations used by casual riders are more concentrated
in the city and along the lake shore. The frequency range per start
station is between 400 and 1600 rides.<br />
</li>
<li>Stations used by annual members are much wider spread over greater
Chicago area (Evanston to Hide Park). The frequency ranges per start
station from 200 to 600 rides and is more equally distributed.<br />
<br />
<br />
</li>
</ul>
</div>
<div id="conclusion-differences-by-location" class="section level4">
<h4>3.4.3 Conclusion: Differences by location</h4>
<ul>
<li>Casuals have a preference for locations along the lake shore and in
park areas</li>
<li>Members have a preference for locations in the city’s business
districts and around university campuses</li>
<li>Casual riders are more concentrated in the city and along the lake
shore, with few hot-spots<br />
</li>
<li>Annual members are more wide spread over greater Chicago area<br />
<br />
<br />
</li>
</ul>
</div>
</div>
<div id="modeling" class="section level3">
<h3>3.5 Modeling</h3>
<div id="identify-correlations-between-members-and-casuals"
class="section level4">
<h4>3.5.1 Identify correlations between members and casuals</h4>
<p>Relationships (correlations) between casuals and members can be best
visualized in scatter plots. We therefore plot the number of rides of
casuals on the x-axis and the number of rides of members on the
y-axis.<br />
<br />
If the groups are correlated, than we can infer that the behavior is not
different<br />
If the groups are only weakly correlated, we can infer that a difference
in behavior exists<br />
<br />
</p>
<p>We will then use a simple linear regression model provided by
geom_smooth (method = lm). The coefficients of the model are not
accessible from geom_smooth. However, we can calculate the R-value with
a simple function that provides a measure of correlation (+/- 1 for high
correlation and 0 for no correlation). The regression slop values are
manually calculated from the graphs.<br />
<br />
</p>
</div>
<div id="prepareing-the-data-set" class="section level4">
<h4>3.5.2 Prepareing the data set</h4>
<p>We will create a new dataframe <code>df_corr</code> to aggregate the
number of rides by hour. The data points will be reduced to about 8700
rows<br />
</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------- select relevant variables</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>tmp1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(start_time),</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(start_time),</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">day</span>(start_time),</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">hour</span>(start_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_time =</span> <span class="fu">make_datetime</span>(year, month, day, hour)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user, new_time, ride_time, season, day_type, hour_type)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------- extract subset for casual</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>tmp_c <span class="ot">&lt;-</span> tmp1 <span class="sc">%&gt;%</span> </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user <span class="sc">==</span> <span class="st">&quot;casual&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(new_time) <span class="sc">%&gt;%</span> </span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rides_casual =</span> <span class="fu">n</span>(), </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">ride_time_casual =</span> <span class="fu">sum</span>(ride_time),</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_ride_time_casual =</span> <span class="fu">mean</span>(ride_time),</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>            season,</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>            day_type,</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>            hour_type) <span class="sc">%&gt;%</span> </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------- extract subset for member</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>tmp_m <span class="ot">&lt;-</span> tmp1 <span class="sc">%&gt;%</span> </span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(user <span class="sc">==</span> <span class="st">&quot;member&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(new_time) <span class="sc">%&gt;%</span> </span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rides_member =</span> <span class="fu">n</span>(), </span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">ride_time_member =</span> <span class="fu">sum</span>(ride_time),</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_ride_time_member =</span> <span class="fu">mean</span>(ride_time),</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>            season,</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>            day_type,</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>            hour_type) <span class="sc">%&gt;%</span> </span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------- Join subsets</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>df_corr <span class="ot">&lt;-</span> tmp_c <span class="sc">%&gt;%</span> </span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(tmp_m)</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------------------------- Clean up</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tmp1, tmp_c, tmp_m)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="overall-correlation" class="section level4">
<h4>3.5.3 Overall correlation</h4>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------- Correlation test</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>corr <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(df_corr<span class="sc">$</span>rides_casual, df_corr<span class="sc">$</span>rides_member)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(corr)</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------- scatter plot</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(new_time, rides_casual, rides_member) <span class="sc">%&gt;%</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rides_casual, <span class="at">y =</span> rides_member))<span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> lm)<span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Relationship between rides casual and rides member&quot;</span>,</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Each data point is an hourly aggregate&quot;</span>) <span class="sc">+</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of rides (casual)&quot;</span>)<span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Number of rides (member)&quot;</span>)<span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_y_continuous(labels = scales::label_number_si())+</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_x_continuous(labels = scales::label_number_si())+</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="dv">90</span>, <span class="at">y=</span><span class="dv">1550</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr<span class="sc">$</span>estimate, <span class="dv">2</span>)), <span class="at">size =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%205.1.1%20-%20correlation%20and%20plot%20-%20overall-1.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(corr)</span></code></pre></div>
<p><br />
Result: </p>
<ul>
<li>The number of rides for casuals and members are correlated by R =
0.8<br />
</li>
<li>The slope of the regression line is about 1:0.9, but we can observe
a large spread the farther we move out on the axis</li>
</ul>
<p>To find some further clues we will look into correlation by season,
weekdays and hour<br />
<br />
</p>
</div>
<div id="correlations-by-seasons" class="section level4">
<h4>3.5.4 Correlations by seasons</h4>
<p>Now let’s split the data in rides by season. The seasons are defined
as:<br />
</p>
<ul>
<li>winter: Jan, Feb, Mar<br />
</li>
<li>spring: Apr, May, Jun<br />
</li>
<li>summer: Jul, Aug, Sep<br />
</li>
<li>autumn: Oct, Nov, Dec<br />
</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;winter&quot;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>df_corr_winter <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">&quot;winter&quot;</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>corr_winter <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_winter<span class="sc">$</span>rides_casual, df_corr_winter<span class="sc">$</span>rides_member)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;spring&quot;</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>df_corr_spring <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">&quot;spring&quot;</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>corr_spring <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_spring<span class="sc">$</span>rides_casual, df_corr_spring<span class="sc">$</span>rides_member)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;summer&quot;</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>df_corr_summer <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">&quot;summer&quot;</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>corr_summer <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_summer<span class="sc">$</span>rides_casual, df_corr_summer<span class="sc">$</span>rides_member)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;autumn&quot;</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>df_corr_autumn <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">&quot;autumn&quot;</span>)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>corr_autumn <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_autumn<span class="sc">$</span>rides_casual, df_corr_autumn<span class="sc">$</span>rides_member)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create annotation fields</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>dat_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_winter<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_spring<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_summer<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_autumn<span class="sc">$</span>estimate, <span class="dv">2</span>))),</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">season =</span> <span class="fu">c</span>(<span class="st">&quot;winter&quot;</span>, <span class="st">&quot;spring&quot;</span>,<span class="st">&quot;summer&quot;</span>, <span class="st">&quot;autumn&quot;</span>)</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>dat_text<span class="sc">$</span>season <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat_text<span class="sc">$</span>season, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>dat_text<span class="sc">$</span>season <span class="ot">&lt;-</span> <span class="fu">fct_relevel</span>(dat_text<span class="sc">$</span>season,</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;winter&quot;</span>,</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;spring&quot;</span>,</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;summer&quot;</span>,</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;autumn&quot;</span>)</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot - season</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(new_time, rides_casual, rides_member, season) <span class="sc">%&gt;%</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rides_casual, <span class="at">y =</span> rides_member))<span class="sc">+</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)<span class="sc">+</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Correlation between casual and member by season&quot;</span>,</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Each data point is an hourly aggregate&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Rides per hour (casual)&quot;</span>)<span class="sc">+</span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides per hour (member)&quot;</span>)<span class="sc">+</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>season, <span class="at">ncol =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_text,</span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> label),</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">27</span>,</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%205.1.2%20-%20correlation%20by%20season-1.png" width="672" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning up</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_corr_winter, df_corr_spring, df_corr_summer, df_corr_autumn, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>   corr_autumn, corr_spring, corr_summer, corr_winter, dat_text)</span></code></pre></div>
<p><br />
Result:<br />
</p>
<ul>
<li>The correlation values for all seasons are between R = 0.7 ~ 0.8, we
<strong>can’t specify differences between casuals and members due to
seasons</strong><br />
</li>
<li>The slopes are a little steeper for winter (1:1.2) and autumn
(1:1.3), i.e. trend to more rides by members than by casuals<br />
</li>
<li>The slopes for summer are close to 1:1, summer (1:0.8) and spring
(1:0.9), i.e. trend to equal number of rides for members and
casuals<br />
<br />
</li>
</ul>
</div>
<div id="correlations-by-weekday" class="section level4">
<h4>3.5.5 Correlations by weekday</h4>
<p>Next let’s split the data in rides by day-type. The day-types are
defined as:<br />
</p>
<ul>
<li>weekend: Sat, Sun<br />
</li>
<li>workday: Mon, Tue, Wed, Thu, Fri<br />
</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;weekend&quot;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>df_corr_we <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(day_type <span class="sc">==</span> <span class="st">&quot;weekend&quot;</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>corr_we <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_we<span class="sc">$</span>rides_casual, df_corr_we<span class="sc">$</span>rides_member)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;workday&quot;</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>df_corr_wd <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(day_type <span class="sc">==</span> <span class="st">&quot;workday&quot;</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>corr_wd <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_wd<span class="sc">$</span>rides_casual, df_corr_wd<span class="sc">$</span>rides_member)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create annotation fields</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>dat_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_we<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_wd<span class="sc">$</span>estimate, <span class="dv">2</span>))),</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">day_type =</span> <span class="fu">c</span>(<span class="st">&quot;weekend&quot;</span>, <span class="st">&quot;workday&quot;</span>)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>dat_text<span class="sc">$</span>day_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat_text<span class="sc">$</span>day_type, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(new_time, rides_casual, rides_member, day_type) <span class="sc">%&gt;%</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rides_casual, <span class="at">y =</span> rides_member))<span class="sc">+</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)<span class="sc">+</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Correlation between casual and member by weekday&quot;</span>,</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Each data point is an hourly aggregate&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Rides per hour (casual)&quot;</span>)<span class="sc">+</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides per hour (member)&quot;</span>)<span class="sc">+</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_text,</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> label),</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">32</span>)<span class="sc">+</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>day_type)  </span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%205.1.3%20-%20correlation%20by%20weekday-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning up</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_corr_we, df_corr_wd, corr_we, corr_wd, dat_text)</span></code></pre></div>
<p><br />
Result: </p>
<ul>
<li>The correlation on weekend (R=0.94) is stronger than on workdays
(R=0.85), i.e. <strong>ride behavior on workdays shows more differences
between the user groups</strong><br />
</li>
<li>The slop on weekends is 1:0.7, i.e. trend to more casuals than
members<br />
</li>
<li>The slop on workdays is 1:1.2, i.e. trend to more members than
casuals<br />
<br />
</li>
</ul>
</div>
<div id="correlation-by-day-time" class="section level4">
<h4>3.5.6 Correlation by day time</h4>
<p>Finally let’s split the data in rides by day time. The day times is
defined as:<br />
<br />
</p>
<ul>
<li>night : 00:01 - 06:00<br />
</li>
<li>morning : 06:01 - 12:00 (morning commute)<br />
</li>
<li>afternoon : 12:01 - 18:00 (afternoon commute)<br />
</li>
<li>evening : 18:01 - 00:00<br />
<br />
</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;night&quot;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>df_corr_night <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hour_type <span class="sc">==</span> <span class="st">&quot;night&quot;</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>corr_night <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_night<span class="sc">$</span>rides_casual, df_corr_night<span class="sc">$</span>rides_member)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;morning&quot;</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>df_corr_morning <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hour_type <span class="sc">==</span> <span class="st">&quot;morning&quot;</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>corr_morning <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_morning<span class="sc">$</span>rides_casual, df_corr_morning<span class="sc">$</span>rides_member)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;afternoon&quot;</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>df_corr_afternoon <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hour_type <span class="sc">==</span> <span class="st">&quot;afternoon&quot;</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>corr_afternoon <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_afternoon<span class="sc">$</span>rides_casual, df_corr_afternoon<span class="sc">$</span>rides_member)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="co"># R coefficient for &quot;evening&quot;</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>df_corr_evening <span class="ot">&lt;-</span> df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hour_type <span class="sc">==</span> <span class="st">&quot;evening&quot;</span>)</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>corr_evening <span class="ot">&lt;-</span>  <span class="fu">cor.test</span>(df_corr_evening<span class="sc">$</span>rides_casual, df_corr_evening<span class="sc">$</span>rides_member)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create annotation fields</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>dat_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_night<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_morning<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_afternoon<span class="sc">$</span>estimate, <span class="dv">2</span>)),</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;R = &quot;</span>, <span class="fu">round</span>(corr_evening<span class="sc">$</span>estimate, <span class="dv">2</span>))),</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">hour_type =</span> <span class="fu">c</span>(<span class="st">&quot;night&quot;</span>, <span class="st">&quot;morning&quot;</span>,<span class="st">&quot;afternoon&quot;</span>, <span class="st">&quot;evening&quot;</span>)</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>dat_text<span class="sc">$</span>hour_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat_text<span class="sc">$</span>hour_type, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>df_corr <span class="sc">%&gt;%</span> </span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(new_time, rides_casual, rides_member, hour_type) <span class="sc">%&gt;%</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rides_casual, <span class="at">y =</span> rides_member))<span class="sc">+</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Correlation between casual and member by day time&quot;</span>,</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Each data point is an hourly aggregate&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Rides per hour (casual)&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rides per hour (member)&quot;</span>)<span class="sc">+</span></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hour_type, <span class="at">ncol =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_text,</span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> label),</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">27</span>,</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="project2_files/figure-html/Graph%205.1.4%20-%20correlation%20by%20hour-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning up</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_corr_night, df_corr_evening, df_corr_morning, df_corr_afternoon,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>   corr_night, corr_morning, corr_evening, corr_afternoon, dat_text)</span></code></pre></div>
<p><br />
Results: </p>
<ul>
<li>The correlation in the morning hours is weak (R=0.65),
i.e.<strong>in the morning hours we can observe more differences in ride
behavior between casuals and members</strong><br />
</li>
<li>The correlations in the afternoon, evening and night hours is about
R=0.8 and correlated<br />
</li>
<li>The slops for morning hours and evening hours is 1:0.9, i.e. trend
to equal number of members and casuals<br />
</li>
<li>The slop for afternoon hours is 1:0.8, i.e. trend to more casual
rides<br />
</li>
<li>The slop for night hours is flat (1:0.5), i.e. trend to more casual
rides<br />
<br />
</li>
</ul>
</div>
<div id="conclusions-for-correlation-between-casuals-and-members"
class="section level4">
<h4>3.5.7 Conclusions for correlation between casuals and members</h4>
<p>The relationship of ride numbers between casual and member user were
analyzed by simple linear regression models segmented into season,
weekdays and hours. All models were significant (very small p-values):
The models verify our findings from the time series in chapter
3.2:<br />
</p>
<ul>
<li>There are no significant difference of user behavior related to
season<br />
</li>
<li>The ride behavior on workdays shows more difference between the user
groups<br />
</li>
<li>In the morning hours a clear difference in ride behavior between
casuals and members can be observed<br />
<br />
<br />
</li>
</ul>
</div>
</div>
</div>
<div id="answer-the-question" class="section level2">
<h2>4. Answer the question</h2>
<p><strong>How do annual members and casual riders use Cyclistic bikes
differently?</strong><br />
<br />
</p>
<div id="differences-between-users" class="section level3">
<h3>4.1 Differences between users</h3>
<p><strong>Overall:</strong><br />
</p>
<ul>
<li>Annual members ride more than casual riders over the year<br />
</li>
<li>Casual riders accumulate more ride time over the year<br />
</li>
<li>The median ride-time of casual riders is longer<br />
<br />
</li>
</ul>
<p><strong>By months:</strong><br />
</p>
<ul>
<li>Both groups show an increase of rides in warmer season and decrease
in colder season<br />
</li>
<li>However, in case of casual riders the change is more extreme,
i.e. more rides in summer and only very few rides in winter<br />
</li>
</ul>
<p><strong>By week</strong>:<br />
</p>
<ul>
<li>Casuals prefer riding on weekends and for longer time<br />
</li>
<li>Members prefer riding on workdays, their ride-time is constant over
the week<br />
<br />
</li>
</ul>
<p><strong>By day</strong>:<br />
</p>
<ul>
<li>Members prefer riding during commute time in the morning and
afternoon hours, indicating that member use their bikes primarily for
commuting<br />
</li>
<li>Casuals use their bikes primarily in the afternoon, indicating that
they use it more for leisure activities<br />
<br />
</li>
</ul>
<p><strong>By bike type:</strong><br />
</p>
<ul>
<li>Casuals favor electric bikes more than members<br />
</li>
<li>On summer weekends casuals use more electric bikes than
members<br />
</li>
<li>Casuals use electric bike to some extend also for the morning
commute, indicating that a portion of casual riders could be interested
in a membership with a seasonal pass<br />
<br />
</li>
</ul>
<p><strong>By location:</strong><br />
</p>
<ul>
<li>Casuals have a preference for locations along the lake shore, in
park areas and in the city<br />
</li>
<li>Members use station all over greater Chicago area with a
concentration in the city’s business districts and on university
campuses<br />
<br />
<br />
</li>
</ul>
</div>
<div id="recommendations" class="section level3">
<h3>4.2 Recommendations:<br />
</h3>
<p><strong>Scenario 1: Introduction of Seasonal
Memberships</strong><br />
<br />
</p>
<ul>
<li>Casual riders show a distinct ride preference from June to September
and on weekends.<br />
</li>
<li>Therefore, we recommend the introduction of seasonal passes for the
warmer season and for weekends.<br />
<br />
</li>
</ul>
<p><strong>Scenario 2: Introduction of Benefit Program for Electric
Bikes</strong><br />
<br />
</p>
<ul>
<li>Casual riders prefer to use more electric bikes than members. A
smaller but significant portion of casual riders use electric bikes
during the morning commute hours. They might be interested in attractive
programs targeting especially electric bikes. This could be combined
with seasonal membership to attract more casual riders.<br />
<br />
</li>
</ul>
<p><strong>Scenario 3: Convert Casual Riders to Annual
Memberships</strong><br />
<br />
</p>
<ul>
<li>Since casuals’ ride pattern distinctively differs from those of
members, it will be difficult to convert casual rider into members even
with extensive promotion programs. We therefore do not recommend this
path.<br />
<br />
<br />
</li>
</ul>
<p><strong>Thank you for your interest !</strong></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
